<div class="post-body">
  <h2 id="目的">目的</h2>
  <p>この記事では、以下のVPS環境でDjangoサイトを構築するために必要な「ApacheとSSL/TLSの初期設定手順」を説明する。</p>
  <ul>
    <li>OS：CentOS 7,4</li>
    <li>言語：Python</li>
    <li>WEBサーバー：Apache</li>
    <li>FW：Django</li>
    <li>DB：PostgresSQL</li>
    <li>ドメイン：example.com</li>
  </ul>
  <h2 id="実施内容">実施内容</h2>
  <h3 id="apachehttpdインストール">Apache(httpd)インストール</h3>
  <ul>
    <li>インストール実行後、<code>Complete!</code>で正常終了。
      <pre><code>$ yum install httpd
</code></pre>
    </li>
  </ul>
  <h3 id="ファイアウォールの設定">ファイアウォールの設定</h3>
  <ul>
    <li>
      <p>CentOS7は、デフォルトでファイアウォールが有効なため、http、httpsも遮断されている状態なのでこの通信を許容するように設定変更する。<br>
        後にSSL/TSL化するため、ここでhttpsも一緒に許容しておく。</p>
      <pre><code>$ systemctl start httpd # Apacheの起動
$ firewall-cmd --add-service=http --zone=public --permanent # http通信の許容
$ firewall-cmd --add-service=https --zone=public --permanent # https通信の許容
$ systemctl restart firewalld # ファイアウォールの再起動
</code></pre>
    </li>
    <li>
      <p>httpでの接続確認<br>
        httpで自身のドメイン(http://example.com)にアクセスし、<code>Testing 123</code>と表示されれば設定成功。</p>
    </li>
  </ul>
  <h3 id="httpd自動起動の設定">httpd自動起動の設定</h3>
  <ul>
    <li>サーバー起動時にhttpdも自動で起動するように設定する。
      <pre><code>$ systemctl enable httpd
</code></pre>
    </li>
    <li>自動起動の設定確認<br>
      <code>httpd.service enabled</code>と表示されれば設定成功。
      <pre><code>$ systemctl list-unit-files -t service
</code></pre>
    </li>
  </ul>
  <h3 id="documentrootの権限変更">DocumentRootの権限変更</h3>
  <ul>
    <li>
      <p>vpsuser(所有者グループ)やapache(所有者)でもDocumentRoot配下(/var/www/html) が編集できるように権限変更する。</p>
      <pre><code>$ cd /var/www
$ chown apache:vpsuser html 
$ chmod 775 html
</code></pre>
    </li>
    <li>
      <p>仮のindexで表示確認<br>
        /var/www/htmlの直下にindex.htmlを新規作成後、httpで自身のドメイン(http://example.com)にアクセスし表示されれば設定成功。</p>
      <pre><code>$ systemctl list-unit-files -t service
</code></pre>
    </li>
  </ul>
  <h3 id="httpsの解放設定">httpsの解放設定</h3>
  <ul>
    <li>
      <p>httpsのサービス解放<br>
        「--permanent」でOSを再起動しても設定が変わらないように設定を恒久化する。
        「--zone=public」で明示的にzoneをpublicに割当てる。<br></p>
      <pre><code>$ firewall-cmd --permanent --zone=public --add-service=https
</code></pre>
    </li>
    <li>
      <p>設定を反映させるためfirewalldを再起動する</p>
      <pre><code>$ systemctl restart firewalld
</code></pre>
    </li>
    <li>
      <p>httpsの解放確認<br>
        servicesにhttpsと表示されれば解放成功。</p>
      <pre><code>$ firewall-cmd --list-all
 public (active)
  target: default
  icmp-block-inversion: no
  interfaces: eth0
  sources:
  services: dhcpv6-client ssh http https
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
</code></pre>
    </li>
  </ul>

</div>
